<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>BotCopier Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>BotCopier Dashboard</h1>
    <canvas id="metricsChart" width="400" height="200"></canvas>
    <h2>Trades</h2>
    <ul id="trades"></ul>
    <h2>Training Progress</h2>
    <ul id="training"></ul>

    <script>
        const token = prompt('API Token');

        const ctx = document.getElementById('metricsChart').getContext('2d');
        const metricsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'Win Rate', data: [], yAxisID: 'y' },
                    { label: 'Flush Latency (ms)', data: [], yAxisID: 'y1' },
                    { label: 'Network Latency (ms)', data: [], yAxisID: 'y1' },
                    { label: 'CVaR', data: [], yAxisID: 'y2' },
                    { label: 'ROC-AUC', data: [], yAxisID: 'y' },
                    { label: 'PR-AUC', data: [], yAxisID: 'y' },
                    { label: 'Brier Score', data: [], yAxisID: 'y' }
                ]
            },
            options: {
                scales: {
                    y: { type: 'linear', position: 'left' },
                    y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false } },
                    y2: { type: 'linear', position: 'right', grid: { drawOnChartArea: false } }
                }
            }
        });

        function updateChart(metric) {
            metricsChart.data.labels.push(metric.time);
            metricsChart.data.datasets[0].data.push(metric.win_rate);
            metricsChart.data.datasets[1].data.push(metric.flush_latency_ms);
            metricsChart.data.datasets[2].data.push(metric.network_latency_ms);
            metricsChart.data.datasets[3].data.push(metric.cvar);
            metricsChart.data.datasets[4].data.push(metric.roc_auc);
            metricsChart.data.datasets[5].data.push(metric.pr_auc);
            metricsChart.data.datasets[6].data.push(metric.brier_score);
            metricsChart.update();
        }

        const metricsWs = new WebSocket(`ws://${location.host}/ws/metrics?token=${token}`);
        metricsWs.onmessage = (event) => {
            const metric = JSON.parse(event.data);
            updateChart(metric);
        };

        const tradesWs = new WebSocket(`ws://${location.host}/ws/trades?token=${token}`);
        tradesWs.onmessage = (event) => {
            const trade = JSON.parse(event.data);
            const li = document.createElement('li');
            li.textContent = `${trade.symbol} ${trade.action} ${trade.lots}`;
            document.getElementById('trades').appendChild(li);
        };

        const trainingWs = new WebSocket(`ws://${location.host}/ws/training_progress?token=${token}`);
        trainingWs.onmessage = (event) => {
            const prog = JSON.parse(event.data);
            const li = document.createElement('li');
            li.textContent = `${prog.step}: ${prog.status}`;
            document.getElementById('training').appendChild(li);
        };
    </script>
</body>
</html>
